<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:hftl="http://hftl.org"
	template="/layout/template.xhtml"
	xmlns:e="http://jboss.com/products/seam/excel"
	xmlns:p="http://primefaces.org/ui">

    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="objectId" value="#{billingRunBean.objectId}" />
        </f:metadata>
    </ui:define>

	<ui:define name="body">
		<h:form id="crumbmenuForm">
			<p:breadCrumb homeDisplay="text" id="crumbmenu">
				<p:menuitem value="#{messages['menu.invoicing']}" disabled="true" />
				<p:menuitem outcome="billingRuns" value="#{messages['menu.billingRuns']}" />				
				<p:menuitem
					value="#{messages['billingRun.panel']} - #{billingRunBean.entity.id}"
					disabled="true" rendered="#{!billingRunBean.entity.transient}" />
			</p:breadCrumb>
		</h:form>	
         <p:messages id="messages" />
		<hftl:formPanel formId="form3" edit="false"
			label="#{messages['postInvoicingReport.title']}"
			backingBean="#{billingRunBean}" showFormButtons="false">
					<hftl:formField
						label="#{messages['postInvoicingReport.globalAmountHT']}"
						field="postInvoicingReports" childField="globalAmount"
						popup="false" converter="bigDecimal4DigitsConverter" />
					<hftl:formField

						label="#{messages['postInvoicingReport.invoicesNumber']}"
						field="postInvoicingReports" childField="invoicesNumber"
						popup="false" />
					<hftl:formField
						label="#{messages['postInvoicingReport.positiveInvoicesNumber']}"
						field="postInvoicingReports" childField="positiveInvoicesNumber"
						popup="false" />

					<hftl:formField
						label="#{messages['postInvoicingReport.positiveInvoicesAmountHT']}"
						field="postInvoicingReports" childField="positiveInvoicesAmountHT"
						popup="false"  converter="bigDecimal4DigitsConverter" />
					<hftl:formField
						label="#{messages['postInvoicingReport.positiveInvoicesAmount']}"
						field="postInvoicingReports" childField="positiveInvoicesAmount"
						popup="false" converter="bigDecimal4DigitsConverter" />

					<hftl:formField id="emptyInvoicesNumber"
						label="#{messages['postInvoicingReport.emptyInvoicesNumber']}"
						field="postInvoicingReports" childField="emptyInvoicesNumber"
						popup="false" />


					<hftl:formField
						label="#{messages['postInvoicingReport.positiveInvoicesTaxAmount']}"
						field="postInvoicingReports"
						childField="positiveInvoicesTaxAmount" popup="false" />
					<hftl:formField
						label="#{messages['postInvoicingReport.negativeInvoicesAmountHT']}"
						field="postInvoicingReports" childField="negativeInvoicesAmountHT"
						popup="false"  converter="bigDecimal4DigitsConverter" />
					<hftl:formField
						label="#{messages['postInvoicingReport.negativeInvoicesTaxAmount']}"
						field="postInvoicingReports"
						childField="negativeInvoicesTaxAmount" popup="false"  converter="bigDecimal4DigitsConverter" />
					<hftl:formField id="positiveInvoicesAmount"
						label="#{messages['postInvoicingReport.negativeInvoicesAmount']}"
						field="postInvoicingReports" childField="negativeInvoicesAmount"
						popup="false" converter="bigDecimal4DigitsConverter"  />
					<hftl:formField id="electronicInvoicesNumber"
						label="#{messages['postInvoicingReport.electronicInvoicesNumber']}"
						field="postInvoicingReports" childField="electronicInvoicesNumber"
						popup="false" />



			<p:fieldset legend="#{messages['postInvoicingReport.invoicesNumberPerPaymentMode']}" styleClass="clearLeft">

				<hftl:formField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkInvoicesNumber"
					popup="false" displayOneLine="true" />

				<hftl:formField label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitInvoicesNumber"
					popup="false" displayOneLine="true" />

				<hftl:formField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipInvoicesNumber"
					popup="false" displayOneLine="true" />

				<hftl:formField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports"
					childField="wiretransferInvoicesNumber" popup="false" displayOneLine="true" />
					
				<hftl:formField
					label="#{messages['paymentMethod.card']}"
					field="postInvoicingReports"
					childField="creditDebitCardInvoicesNumber" popup="false" displayOneLine="true" />
					
				 </p:fieldset>	 
			
			<p:fieldset legend="#{messages['postInvoicingReport.amoutHtPerPaymentMode']}" styleClass="clearLeft">

				<hftl:formField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkAmuontHT"
					popup="false" converter="bigDecimal4DigitsConverter" displayOneLine="true" />

				<hftl:formField label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitAmuontHT"
					popup="false" converter="bigDecimal4DigitsConverter" displayOneLine="true" />


				<hftl:formField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipAmuontHT" popup="false" converter="bigDecimal4DigitsConverter" displayOneLine="true" />

				<hftl:formField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports" childField="wiretransferAmuontHT"
					popup="false" converter="bigDecimal4DigitsConverter" displayOneLine="true" />
					
				<hftl:formField
					label="#{messages['paymentMethod.card']}"
					field="postInvoicingReports" childField="creditDebitCardAmountHT"
					popup="false" converter="bigDecimal4DigitsConverter" displayOneLine="true" />	

             </p:fieldset>
			 <p:fieldset legend="#{messages['postInvoicingReport.amoutTtcPerPaymentMode']}" styleClass="clearLeft">
				<hftl:formField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkAmuont" popup="false" converter="bigDecimal4DigitsConverter" displayOneLine="true" />

				<hftl:formField label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitAmuont"
					popup="false"  converter="bigDecimal4DigitsConverter" displayOneLine="true"/>


				<hftl:formField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipAmuont" popup="false"  converter="bigDecimal4DigitsConverter" displayOneLine="true"/>


				<hftl:formField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports" childField="wiretransferAmuont"
					popup="false"  converter="bigDecimal4DigitsConverter" displayOneLine="true"/>
					
				<hftl:formField
					label="#{messages['paymentMethod.card']}"
					field="postInvoicingReports" childField="creditDebitCardAmount"
					popup="false"  converter="bigDecimal4DigitsConverter" displayOneLine="true"/>	
					
            </p:fieldset>

		</hftl:formPanel>


		<h:outputText value="#{messages['postInvoicingReport.billableBA']}"
			style="font-weight: bold;font-size=14;" />
		<hftl:dataList  dataModel="#{billingRunBean.entity.invoices}"  
			backingBean="#{invoiceBean}">
        <p:ajax event="rowSelectCheckbox"    listener="#{invoiceBean.onRowSelectCheckbox}" update=":excludeBa" />
        <p:ajax event="rowUnselectCheckbox"  listener="#{invoiceBean.onRowUnSelectCheckbox}"  update=":excludeBa"  /> 

			<hftl:column label="#{messages['businessEntity.code']}" objectIdParamName="billingAccountId"
				field="billingAccount.code" entityView="billingAccountDetail" valueIdField="billingAccount.id"/>
			<p:column width="100">
				<f:facet name="header">
					<h:outputText value="#{messages['name.title']}" />
				</f:facet>
				<e:cell>
					<h:outputText
						rendered="#{entity.billingAccount.name.title != null}"
						value="#{entity.billingAccount.name.title.description}" />
				</e:cell>
			</p:column>

			<hftl:column label="#{messages['billingAccount.name']}"
				field="billingAccount.name" />

			<hftl:column label="#{messages['invoice.amountWithoutTax']}"
				field="amountWithoutTax" converterParam="4digits"/>
			<hftl:column label="#{messages['invoice.amountTax']}"
				field="amountTax" converterParam="4digits" />
			<hftl:column label="#{messages['invoice.amountWithTax']}"
				field="amountWithTax" converterParam="4digits" />
		</hftl:dataList>
		 <p:panel styleClass="action-buttons" >
			<p:tooltip for="excludeBa"
				showEffect="slide" hideEffect="slide" />
			<p:commandButton id="excludeBa" style="left:10px; top:-26px" disabled="#{!invoiceBean.isSelectedInvoices}"
				value="#{messages['postInvoicingReport.excludeBillingAccounts']}"
				update=":results_form :messages" action="#{invoiceBean.excludeBillingAccounts(billingRunBean.entity)}" 
				rendered="#{billingRunBean.entity.status.toString() != 'VALIDATED' and billingRunBean.entity.getInvoices().size()>0}">
				<p:confirm header="#{messages['commons.confirmationHeader']}"
					message="#{messages['commons.excludeBillingAccounts']}"
					icon="ui-icon-alert" />
			</p:commandButton>
		</p:panel>

		<h:outputText
			value="#{messages['postInvoicingReport.rejectedBillingAccounts']}"
			style="font-weight: bold;font-size=14;" />
		<p:panel id="rejectedBA_panel" width="100">
			<h:form id="rejectedBA_formId" prependId="false">
				<p:dataTable id="dataTable_rejectedBA" var="entity"
					value="#{billingRunBean.entity.rejectedBillingAccounts}"
					paginator="true" rows="10" resizableColumns="true"
					binding="#{billingAccountBean.dataTable}"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					rowsPerPageTemplate="5,10,15" lazy="true" styleClass="custom-grid"
					rowKey="#{entity.id}">

					<hftl:column label="#{messages['businessEntity.code']}"
						field="billingAccount.code" />

					<p:column width="100">
						<f:facet name="header">
							<h:outputText value="#{messages['name.title']}" />
						</f:facet>
						<e:cell>
							<h:outputText
								rendered="#{entity.billingAccount.name.title != null}"
								value="#{entity.billingAccount.name.title.description}" />
						</e:cell>
					</p:column>

					<hftl:column label="#{messages['billingAccount.name']}"
						field="billingAccount.name" />

					<hftl:column
						label="#{messages['RejectedBillingAccounts.rejectCause']}"
						field="rejectCause" />

				</p:dataTable>

				<p:blockUI block="dataTable_rejectedBA"
					trigger="dataTable_rejectedBA">
        		LOADING<br />
					<p:graphicImage name="ajax-loader1.gif" library="img" />
				</p:blockUI>
			</h:form>
		</p:panel>

		<hftl:decorateFormField label="#{messages['billingRuns.launchInvoicing']}" displayOneLine="true" componentWidth="50">
			<p:selectBooleanCheckbox
				value="#{billingRunBean.launchInvoicingRejectedBA}" />
		</hftl:decorateFormField>

		<h:form id="operationsForm" rendered="#{!edit}">
			<div class="action-buttons">
				<p:commandButton action="#{billingRunBean.validateInvoicing()}"
					value="#{messages['action.validate']}" 
					rendered="#{billingRunBean.entity.status.toString() != 'VALIDATED'}"/>
				<!-- <h:commandButton
				action="#{billingRunBean.rerateConfirmedInvoicing()}"
				value="Rerate" /> -->
				<p:commandButton
					action="#{billingRunBean.cancelConfirmedInvoicing()}"
					value="#{messages['action.cancel']}"
					rendered="#{billingRunBean.entity.status.toString() != 'VALIDATED'}"
					onclick="if(confirm('#{messages['commons.confirmCancelInvoiceProcess']}')){return true;}else{return false;}" />
				
				<p:button id="backToBillingRuns" outcome="billingRuns"
					value="#{messages['action.back']}"
					rendered="#{billingRunBean.entity.status.toString() == 'VALIDATED'}" />
			</div>
		</h:form>
	</ui:define>
</ui:composition>